<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Mi Progreso</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="progress-container">
    
    <!-- Sección de Registro Rápido -->
    <ion-card class="quick-actions">
      <ion-card-header>
        <ion-card-title>Registro Rápido</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <!-- Estatura (editable) -->
        <ion-item class="form-item">
          <ion-label position="stacked">Estatura (cm)</ion-label>
          <ion-input 
            type="number" 
            [(ngModel)]="userHeight"
            placeholder="Tu estatura"
            (ionChange)="updateHeight()">
          </ion-input>
        </ion-item>

        <!-- Registro de Peso -->
        <div class="action-section">
          <h3>Registrar Peso</h3>
          <p *ngIf="canRegisterWeight()" class="info-text">
            ✅ Puedes registrar tu peso hoy
          </p>
          <p *ngIf="!canRegisterWeight()" class="info-text">
            ⏳ Próximo registro: {{getNextWeightDate() | date:'mediumDate'}}
          </p>
          
          <ion-item class="form-item">
            <ion-input 
              type="number" 
              [(ngModel)]="currentWeight"
              placeholder="Peso actual (kg)"
              [disabled]="!canRegisterWeight()">
            </ion-input>
          </ion-item>
          
          <ion-button 
            expand="block" 
            (click)="registerWeight()"
            [disabled]="!currentWeight || !canRegisterWeight()"
            class="action-button">
            <ion-icon slot="start" name="add"></ion-icon>
            Registrar Peso
          </ion-button>
        </div>

        <!-- Registro de Emoción -->
        <div class="action-section">
          <h3>¿Cómo te sientes hoy?</h3>
          <p class="info-text">
            {{hasRegisteredMoodToday() ? '✅ Ya registraste hoy' : '📝 Registra tu estado de ánimo'}}
          </p>
          
          <ion-radio-group [(ngModel)]="currentMood" class="mood-options">
            <ion-radio value="excelente" justify="start" class="mood-option">
              <ion-label>😊 Excelente</ion-label>
            </ion-radio>
            <ion-radio value="bueno" justify="start" class="mood-option">
              <ion-label>🙂 Bien</ion-label>
            </ion-radio>
            <ion-radio value="regular" justify="start" class="mood-option">
              <ion-label>😐 Regular</ion-label>
            </ion-radio>
            <ion-radio value="malo" justify="start" class="mood-option">
              <ion-label>😔 Mal</ion-label>
            </ion-radio>
          </ion-radio-group>
          
          <ion-button 
            expand="block" 
            fill="outline"
            (click)="registerMood()"
            [disabled]="!currentMood || hasRegisteredMoodToday()"
            class="action-button">
            <ion-icon slot="start" name="happy"></ion-icon>
            Registrar Estado
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Sección de Gráficos -->
    <div class="charts-section">
      <h2>Tu Progreso</h2>
      
      <!-- Gráfico de Peso -->
      <ion-card *ngIf="weightData.length > 1" class="chart-card">
        <ion-card-header>
          <ion-card-title>📈 Progreso de Peso</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="chart-container">
            <canvas #weightChart></canvas>
          </div>
          <div class="chart-stats">
            <p><strong>Inicio:</strong> {{weightData[weightData.length-1]?.weight}} kg</p>
            <p><strong>Actual:</strong> {{weightData[0]?.weight}} kg</p>
            <p><strong>Cambio:</strong> 
              <span [class.positive]="getWeightChange() < 0" 
                    [class.negative]="getWeightChange() > 0">
                {{getWeightChange() > 0 ? '+' : ''}}{{getWeightChange()}} kg
              </span>
            </p>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Gráfico de IMC -->
      <ion-card *ngIf="weightData.length > 1 && userHeight" class="chart-card">
        <ion-card-header>
          <ion-card-title>📊 Evolución del IMC</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="chart-container">
            <canvas #bmiChart></canvas>
          </div>
          <div class="chart-stats">
            <p><strong>IMC Actual:</strong> {{getCurrentBMI() | number:'1.1-1'}}</p>
            <p><strong>Categoría:</strong> {{getBMICategory(getCurrentBMI())}}</p>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Gráfico de Estados de Ánimo -->
      <ion-card *ngIf="moodData.length > 0" class="chart-card">
        <ion-card-header>
          <ion-card-title>😊 Estados de Ánimo</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="chart-container">
            <canvas #moodChart></canvas>
          </div>
          <div class="mood-summary">
            <p><strong>Estado más común:</strong> {{getMostFrequentMood()}}</p>
            <p><strong>Registros este mes:</strong> {{getMoodCountThisMonth()}}</p>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Mensaje si no hay datos -->
      <ion-card *ngIf="userIndicators.length === 0" class="no-data-card">
        <ion-card-content>
          <div class="no-data">
            <ion-icon name="stats-chart" size="large"></ion-icon>
            <h3>Comienza tu Journey</h3>
            <p>Registra tu primer peso y estado de ánimo para ver tus gráficas de progreso.</p>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>