<!-- receta-detalle.page.html - VERSI√ìN COMPLETA CON ALERTAS ESTILO HOME -->
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="logo-title">
      <div class="title-content">
        <span>Detalle de Receta</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="receta-detalle-content">
  <div class="content-wrapper" *ngIf="receta">
    
    <!-- HERO SECTION -->
    <div class="receta-hero">
      <div class="hero-background" [style.background]="getGradient()"></div>
      <div class="hero-content">
        <div class="meal-time-badge">
          {{ receta.categoria | titlecase }}
        </div>
        <div class="food-icon-large">
          {{ getFoodIcon() }}
        </div>
        <h1 class="receta-title">{{ receta.titulo }}</h1>
        <p class="receta-subtitle">{{ receta.descripcion }}</p>
      </div>
    </div>

    <!-- üö® ALERTA DE ALIMENTOS A EVITAR - ESTILO HOME -->
    <div *ngIf="ingredientesProblema.length > 0" class="alerta-container">
      <div class="alerta-card">
        <div class="alerta-header">
          <div class="alerta-icon">
            <ion-icon name="warning" class="warning-icon"></ion-icon>
          </div>
          <div class="alerta-title">
            <h3>Ingredientes a Considerar</h3>
            <p>Hemos detectado algunos ingredientes que prefieres evitar</p>
          </div>
        </div>
        
        <div class="alerta-content">
          <div class="ingredientes-problema">
            <div class="ingrediente-item" *ngFor="let ingrediente of ingredientesProblema">
              <ion-icon name="close-circle" class="ingrediente-icon"></ion-icon>
              <span class="ingrediente-nombre">{{ingrediente}}</span>
            </div>
          </div>
          
          <div class="alerta-message">
            <p>No te preocupes, puedes adaptar esta receta sustituyendo estos ingredientes.</p>
          </div>
        </div>

        <div class="alerta-actions">
          <ion-button fill="solid" color="warning" (click)="mostrarSugerenciasSustitucion()" class="action-btn">
            <ion-icon slot="start" name="bulb-outline"></ion-icon>
            Ver Alternativas
          </ion-button>
          <ion-button fill="outline" color="medium" (click)="irAPerfil()" class="action-btn">
            <ion-icon slot="start" name="settings-outline"></ion-icon>
            Preferencias
          </ion-button>
        </div>
      </div>
    </div>

    <!-- RECETA INFO SECTION -->
    <div class="receta-info-section">
      <div class="info-grid">
        <div class="info-item">
          <ion-icon name="time-outline"></ion-icon>
          <div class="info-content">
            <span class="info-value">{{ receta.tiempoTotal }} min</span>
            <span class="info-label">Tiempo Total</span>
          </div>
        </div>
        
        <div class="info-item">
          <ion-icon name="flame-outline"></ion-icon>
          <div class="info-content">
            <span class="info-value">{{ receta.calorias || 0 }} cal</span>
            <span class="info-label">Calor√≠as</span>
          </div>
        </div>
        
        <div class="info-item">
          <ion-icon name="restaurant-outline"></ion-icon>
          <div class="info-content">
            <span class="info-value">{{ receta.porciones }}</span>
            <span class="info-label">Porciones</span>
          </div>
        </div>
        
        <div class="info-item">
          <ion-icon name="speedometer-outline"></ion-icon>
          <div class="info-content">
            <span class="info-value">{{ receta.dificultad | titlecase }}</span>
            <span class="info-label">Dificultad</span>
          </div>
        </div>
      </div>
    </div>

    <!-- INFORMACI√ìN NUTRICIONAL -->
    <ion-card class="nutricion-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="fitness-outline" color="primary"></ion-icon>
          Informaci√≥n Nutricional
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="nutricion-grid">
          <div class="nutriente">
            <div class="nutriente-icon">ü•©</div>
            <div class="nutriente-info">
              <span class="nutriente-value">{{ receta.nutricion?.proteinas || 0 }}g</span>
              <span class="nutriente-label">Prote√≠nas</span>
            </div>
          </div>
          
          <div class="nutriente">
            <div class="nutriente-icon">üçö</div>
            <div class="nutriente-info">
              <span class="nutriente-value">{{ receta.nutricion?.carbohidratos || 0 }}g</span>
              <span class="nutriente-label">Carbohidratos</span>
            </div>
          </div>
          
          <div class="nutriente">
            <div class="nutriente-icon">ü•ë</div>
            <div class="nutriente-info">
              <span class="nutriente-value">{{ receta.nutricion?.grasas || 0 }}g</span>
              <span class="nutriente-label">Grasas</span>
            </div>
          </div>
          
          <div class="nutriente">
            <div class="nutriente-icon">üåæ</div>
            <div class="nutriente-info">
              <span class="nutriente-value">{{ receta.nutricion?.fibra || 0 }}g</span>
              <span class="nutriente-label">Fibra</span>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- INGREDIENTES -->
    <ion-card class="ingredientes-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="cart-outline" color="primary"></ion-icon>
          Ingredientes
        </ion-card-title>
        <ion-card-subtitle>Para {{ receta.porciones }} porciones</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item *ngFor="let ingrediente of receta.ingredientes" class="ingrediente-item">
            <ion-label>
              <h3>{{ ingrediente.nombre }}</h3>
              <p>{{ ingrediente.cantidad }} {{ ingrediente.unidad }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- INSTRUCCIONES -->
    <ion-card class="instrucciones-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="restaurant-outline" color="primary"></ion-icon>
          Instrucciones
        </ion-card-title>
        <ion-card-subtitle>Sigue estos pasos</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <div class="instrucciones-list">
          <div *ngFor="let instruccion of receta.instrucciones; let i = index" 
               class="instruccion-item">
            <div class="instruccion-number">{{ i + 1 }}</div>
            <div class="instruccion-text">{{ instruccion }}</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- ETIQUETAS -->
    <ion-card class="etiquetas-card" *ngIf="receta.etiquetas && receta.etiquetas.length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="pricetags-outline" color="primary"></ion-icon>
          Etiquetas
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="etiquetas-container">
          <ion-chip *ngFor="let etiqueta of receta.etiquetas" color="primary">
            <ion-label>{{ etiqueta | titlecase }}</ion-label>
          </ion-chip>
        </div>
      </ion-card-content>
    </ion-card>

    <div class="bottom-spacer"></div>
  </div>

  <!-- LOADING STATE -->
  <div *ngIf="!receta" class="loading-state">
    <div class="spinner-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando receta...</p>
    </div>
  </div>
</ion-content>