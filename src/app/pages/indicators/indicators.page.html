<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Registro de Indicadores</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Formulario -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Nuevo Registro</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <form [formGroup]="indicatorForm" (ngSubmit)="submitIndicator()">
        <!-- Peso -->
        <ion-item>
          <ion-label position="stacked">Peso (kg)</ion-label>
          <ion-input 
            type="number" 
            formControlName="weight"
            placeholder="Ej: 70">
          </ion-input>
        </ion-item>
        <ion-note color="danger" *ngIf="formControls['weight'].touched && formControls['weight'].errors">
          <span *ngIf="formControls['weight'].errors?.['required']">El peso es requerido</span>
          <span *ngIf="formControls['weight'].errors?.['min']">El peso debe ser mayor a 30kg</span>
          <span *ngIf="formControls['weight'].errors?.['max']">El peso debe ser menor a 300kg</span>
        </ion-note>

        <!-- Altura -->
        <ion-item>
          <ion-label position="stacked">Altura (cm)</ion-label>
          <ion-input 
            type="number" 
            formControlName="height"
            placeholder="Ej: 170">
          </ion-input>
        </ion-item>
        <ion-note color="danger" *ngIf="formControls['height'].touched && formControls['height'].errors">
          <span *ngIf="formControls['height'].errors?.['required']">La altura es requerida</span>
          <span *ngIf="formControls['height'].errors?.['min']">La altura debe ser mayor a 100cm</span>
          <span *ngIf="formControls['height'].errors?.['max']">La altura debe ser menor a 250cm</span>
        </ion-note>

        <!-- Estado de 치nimo -->
        <ion-item>
          <ion-label position="stacked">Estado de 치nimo</ion-label>
          <ion-select formControlName="mood" placeholder="Selecciona tu estado de 치nimo">
            <ion-select-option value="excelente">游땕 Excelente</ion-select-option>
            <ion-select-option value="bueno">游뗵 Bueno</ion-select-option>
            <ion-select-option value="regular">游땛 Regular</ion-select-option>
            <ion-select-option value="malo">游땞 Malo</ion-select-option>
            <ion-select-option value="terrible">游땩 Terrible</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-note color="danger" *ngIf="formControls['mood'].touched && formControls['mood'].errors?.['required']">
          El estado de 치nimo es requerido
        </ion-note>

        <!-- Notas -->
        <ion-item>
          <ion-label position="stacked">Notas</ion-label>
          <ion-textarea 
            formControlName="notes"
            placeholder="Observaciones adicionales..."
            rows="3">
          </ion-textarea>
        </ion-item>

        <!-- Fecha -->
        <ion-item>
          <ion-label position="stacked">Fecha</ion-label>
          <ion-input 
            type="date" 
            formControlName="date">
          </ion-input>
        </ion-item>

        <!-- Bot칩n enviar -->
        <ion-button 
          expand="block" 
          type="submit" 
          [disabled]="!indicatorForm.valid || loading"
          class="ion-margin-top">
          <ion-loading *ngIf="loading"></ion-loading>
          {{ loading ? 'Guardando...' : 'Guardar Indicador' }}
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

  <!-- Lista de registros -->
  <ion-card *ngIf="userIndicators.length > 0">
    <ion-card-header>
      <ion-card-title>Tus Registros</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let indicator of userIndicators">
          <ion-label>
            <h3>{{ formatDate(indicator.date) }}</h3>
            <p>Peso: {{ indicator.weight }}kg | Altura: {{ indicator.height }}cm</p>
            <p>BMI: {{ indicator.bmi }} ({{ getBMICategory(indicator.bmi) }})</p>
            <p>Estado: {{ getMoodEmoji(indicator.mood) }} {{ indicator.mood }}</p>
            <p *ngIf="indicator.notes">{{ indicator.notes }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Mensaje cuando no hay registros -->
  <ion-card *ngIf="userIndicators.length === 0 && !loading">
    <ion-card-content>
      <p class="ion-text-center">No hay registros a칰n. 춰Agrega tu primer indicador!</p>
    </ion-card-content>
  </ion-card>
</ion-content>