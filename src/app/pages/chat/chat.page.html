<!-- src/app/pages/chat/chat.page.html -->

<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <!-- Un botón de retroceso si la página de chat no es la raíz -->
      <!-- Puedes cambiar 'back' por una ruta específica si es necesario -->
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Aura, tu asistente de bienestar</ion-title>
    <ion-buttons slot="end">
      <!-- Puedes añadir un botón para más opciones, ajustes, etc. -->
      <ion-button><ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon></ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding custom-background">
  <!-- Contenedor principal de mensajes para aplicar estilos de burbuja y espaciado -->
  <div class="message-container">
    <div
      *ngFor="let msg of messages"
      [class.user-message]="msg.sender === 'user'"
      [class.bot-message]="msg.sender === 'bot'"
      class="chat-bubble"
    >
      <ion-avatar *ngIf="msg.sender === 'bot'" class="bot-avatar">
        <!-- Ícono o imagen para el avatar del bot -->
        <img alt="Bot Avatar" src="assets/icon/bot-icon.png" />
      </ion-avatar>
      <div class="message-content">
        <p [innerHTML]="msg.text"></p>
        <!-- Puedes añadir un timestamp aquí si lo deseas -->
        <!-- <span class="message-time">{{ 'Ahora' }}</span> -->
      </div>
      <ion-avatar *ngIf="msg.sender === 'user'" class="user-avatar">
        <!-- Ícono o imagen para el avatar del usuario -->
        <img alt="User Avatar" src="assets/icon/user-icon.png" />
      </ion-avatar>
    </div>

    <!-- Indicador de "escribiendo..." del bot -->
    <div *ngIf="botIsTyping" class="bot-message chat-bubble typing-indicator">
      <ion-avatar class="bot-avatar">
        <img alt="Bot Avatar" src="assets/icon/bot-icon.png" />
      </ion-avatar>
      <div class="message-content">
        <div class="typing-dots">
          <span>.</span><span>.</span><span>.</span>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<ion-footer>
  <ion-toolbar class="input-toolbar">
    <ion-item lines="none" class="message-input-item">
      <ion-input
        [(ngModel)]="newMessage"
        placeholder="Escribe tu mensaje..."
        (keyup.enter)="sendMessage()"
        [clearOnEdit]="false"
        class="message-input"
      ></ion-input>
      <ion-button slot="end" (click)="sendMessage()" [disabled]="!newMessage.trim()" class="send-button">
        <ion-icon slot="icon-only" name="paper-plane"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-toolbar>
</ion-footer>