<!-- planes.page.html - CON SELECTOR NUTRICI√ìN/EJERCICIOS -->
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()" aria-label="Volver">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="logo-title">
      <div class="title-content">
        <span>Mis Planes</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="planes-content" [scrollEvents]="true">
  <div class="content-padding-top"></div>
  
  <div class="content-wrapper">
    
    <!-- ‚úÖ AGREGADO: SELECTOR DE SECCI√ìN NUTRICI√ìN/EJERCICIOS -->
    <div class="segment-container">
      <ion-segment [value]="seccionActiva" (ionChange)="cambiarSeccion($event)" class="custom-segment" aria-label="Seleccionar secci√≥n">
        <ion-segment-button value="nutricion" class="segment-button">
          <div class="segment-content">
            <ion-icon name="restaurant" aria-hidden="true"></ion-icon>
            <ion-label>Nutrici√≥n</ion-label>
          </div>
        </ion-segment-button>
        <ion-segment-button value="ejercicio" class="segment-button">
          <div class="segment-content">
            <ion-icon name="fitness" aria-hidden="true"></ion-icon>
            <ion-label>Ejercicio</ion-label>
          </div>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- ESTADO DE CARGA -->
    <div *ngIf="cargando" class="cargando-state">
      <div class="spinner-container">
        <ion-spinner name="crescent" aria-label="Cargando planes"></ion-spinner>
        <p>Cargando tu plan...</p>
      </div>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="main-content">
      
      <!-- ========================================
           üçΩÔ∏è SECCI√ìN NUTRICI√ìN
           ======================================== -->
      <div *ngIf="!cargando && seccionActiva === 'nutricion'" class="seccion-content">
        
        <!-- PLAN ACTIVO CON PROGRESO -->
        <div *ngIf="planActual?.activo && progresoDieta" class="current-plan-section">
          
          <!-- ‚ö†Ô∏è ALERTAS DE TIEMPO -->
          <ion-card 
            *ngIf="progresoDieta.alertasTiempo && progresoDieta.alertasTiempo.length > 0" 
            class="alert-card"
            [class.danger]="progresoDieta.estaVencida"
            [class.warning]="progresoDieta.excedeTiempoRecomendado">
            <ion-card-content>
              <div class="alert-icon">
                <ion-icon 
                  [name]="progresoDieta.estaVencida ? 'warning' : 'information-circle'"
                  [color]="progresoDieta.estaVencida ? 'danger' : 'warning'"
                  aria-hidden="true">
                </ion-icon>
              </div>
              <div class="alert-messages">
                <div 
                  *ngFor="let alerta of progresoDieta.alertasTiempo; let i = index" 
                  class="alert-item"
                  [class]="alerta.tipo"
                  [attr.aria-label]="'Alerta: ' + alerta.mensaje">
                  {{alerta.mensaje}}
                </div>
              </div>
            </ion-card-content>
          </ion-card>

          <!-- TARJETA DE PLAN ACTUAL -->
          <ion-card class="plan-card">
            <div class="plan-header">
              <div class="plan-icon" [attr.aria-label]="'Icono de ' + getDietaNombre(planActual?.dietaSeleccionada)">{{getDietaIcon(planActual?.dietaSeleccionada)}}</div>
              <div class="plan-info">
                <h2>Tu Plan Actual</h2>
                <p class="plan-nombre">{{getDietaNombre(planActual?.dietaSeleccionada)}}</p>
              </div>
              <div class="plan-badge" [class]="getProgresoClase()" [attr.aria-label]="progresoDieta.diasCompletados + ' d√≠as completados'">
                {{progresoDieta.diasCompletados}} d√≠as
              </div>
            </div>

            <!-- ESTAD√çSTICAS DEL PLAN -->
            <div class="plan-stats">
              <div class="stat-item">
                <div class="stat-value">{{planActual?.objetivoCaloricoPersonalizado || 0}}</div>
                <div class="stat-label">Calor√≠as/d√≠a</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">{{progresoDieta.diasRestantes}}</div>
                <div class="stat-label">D√≠as Restantes</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">{{progresoDieta.porcentajeCompletado}}%</div>
                <div class="stat-label">Completado</div>
              </div>
            </div>

            <!-- BARRA DE PROGRESO MEJORADA -->
            <div class="progreso-section-mejorada">
              <div class="progreso-header">
                <div class="progreso-title">
                  <ion-icon name="trending-up" aria-hidden="true"></ion-icon>
                  <span>Progreso de tu Dieta</span>
                </div>
                <div class="progreso-porcentaje-grande">
                  {{progresoDieta.porcentajeCompletado}}%
                </div>
              </div>

              <div class="progreso-bar-container-mejorada">
                <div 
                  class="progreso-fill-mejorada" 
                  [style.width.%]="progresoDieta.porcentajeCompletado"
                  [class.completado]="progresoDieta.porcentajeCompletado === 100"
                  [class.advertencia]="progresoDieta.excedeTiempoRecomendado"
                  [attr.aria-label]="'Progreso: ' + progresoDieta.porcentajeCompletado + ' por ciento'">
                  <span class="progreso-label-interno">{{progresoDieta.porcentajeCompletado}}%</span>
                </div>
              </div>

              <div class="progreso-detalles">
                <div class="detalle-item">
                  <ion-icon name="calendar" aria-hidden="true"></ion-icon>
                  <span>Inicio: {{formatearFecha(progresoDieta.fechaInicio)}}</span>
                </div>
                <div class="detalle-item">
                  <ion-icon name="flag" aria-hidden="true"></ion-icon>
                  <span>Fin: {{formatearFecha(progresoDieta.fechaFin)}}</span>
                </div>
              </div>

              <!-- RACHA Y D√çAS SEGUIDOS -->
              <div class="progreso-racha" *ngIf="progresoDieta.racha || progresoDieta.diasSeguidos">
                <div class="racha-item">
                  <ion-icon name="flame" color="warning" aria-hidden="true"></ion-icon>
                  <div class="racha-info">
                    <span class="racha-valor">{{progresoDieta.racha || 0}}</span>
                    <span class="racha-label">Racha</span>
                  </div>
                </div>
                <div class="racha-item">
                  <ion-icon name="checkmark-circle" color="success" aria-hidden="true"></ion-icon>
                  <div class="racha-info">
                    <span class="racha-valor">{{progresoDieta.diasSeguidos || 0}}</span>
                    <span class="racha-label">D√≠as Seguidos</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- BOT√ìN MARCAR D√çA COMO COMPLETADO -->
            <div class="marcar-dia-section">
              <ion-button 
                expand="block" 
                color="success"
                (click)="marcarDiaCompletado()"
                [disabled]="diaYaMarcado"
                [attr.aria-label]="diaYaMarcado ? 'D√≠a ya registrado' : 'Marcar hoy como d√≠a completado'">
                <ion-icon slot="start" name="checkmark-circle" aria-hidden="true"></ion-icon>
                {{diaYaMarcado ? '‚úÖ D√≠a Registrado' : 'Marcar Hoy como Completado'}}
              </ion-button>
            </div>

            <!-- ACCIONES DEL PLAN -->
            <div class="plan-actions">
              <ion-button expand="block" color="primary" (click)="verPlanCompleto()" aria-label="Ver planificaci√≥n completa">
                <ion-icon slot="start" name="calendar" aria-hidden="true"></ion-icon>
                Ver Planificaci√≥n
              </ion-button>
              <ion-button expand="block" fill="outline" color="medium" (click)="cambiarPlan()" aria-label="Cambiar plan actual">
                <ion-icon slot="start" name="swap-horizontal" aria-hidden="true"></ion-icon>
                Cambiar Plan
              </ion-button>
            </div>
          </ion-card>

          <!-- RECOMENDACIONES DEL D√çA -->
          <div class="recetas-section" *ngIf="recetasDelDia.length > 0">
            <div class="section-header">
              <div class="section-title">
                <div class="title-icon" aria-hidden="true">üçΩÔ∏è</div>
                <span>Recomendaciones de Hoy</span>
              </div>
            </div>

            <div class="recetas-grid">
              <ion-card class="receta-card" *ngFor="let receta of recetasDelDia; let i = index" 
                        (click)="seleccionarComida(receta, i)"
                        [attr.aria-label]="'Receta: ' + receta.titulo + '. ' + receta.descripcion">
                <div class="receta-image">
                  <div class="meal-time">
                    {{ getTiempoComida(i) }}
                  </div>
                  <div class="food-icon" aria-hidden="true">
                    {{ getComidaIcon(i) }}
                  </div>
                </div>
                
                <div class="receta-content">
                  <h3 class="receta-title">{{ receta.titulo }}</h3>
                  <p class="receta-description">{{ receta.descripcion }}</p>
                  
                  <div class="receta-meta">
                    <div class="meta-item">
                      <ion-icon name="time" aria-hidden="true"></ion-icon>
                      <span>{{ receta.tiempoTotal }} min</span>
                    </div>
                    <div class="meta-item">
                      <ion-icon name="flame" aria-hidden="true"></ion-icon>
                      <span>{{ receta.calorias }} cal</span>
                    </div>
                    <div class="meta-item">
                      <ion-icon name="restaurant" aria-hidden="true"></ion-icon>
                      <span>{{ receta.porciones }} porc.</span>
                    </div>
                  </div>
                </div>
              </ion-card>
            </div>
          </div>

          <!-- SIN RECETAS -->
          <ion-card *ngIf="recetasDelDia.length === 0 && planActual?.activo" class="empty-state-card">
            <ion-card-content class="empty-content">
              <div class="empty-icon" aria-hidden="true">üçΩÔ∏è</div>
              <h3>No hay recetas disponibles</h3>
              <p>No se encontraron recetas para tu dieta actual</p>
              <ion-button fill="outline" (click)="verRecetasDietaSiExiste()" *ngIf="getDietaActual()" aria-label="Ver todas las recetas disponibles">
                Ver todas las recetas
              </ion-button>
            </ion-card-content>
          </ion-card>
        </div>

        <!-- SIN PLAN ACTIVO - SELECCIONAR DIETA -->
        <div *ngIf="!planActual?.activo" class="sin-plan-section">
          
          <!-- üìã DISCLAIMER DE NUTRICIONISTA -->
          <ion-card class="disclaimer-card">
            <ion-card-header>
              <div class="disclaimer-icon" aria-hidden="true">‚öïÔ∏è</div>
              <ion-card-title>Consulta con un Profesional</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p class="disclaimer-text">
                <strong>Importante:</strong> Antes de iniciar cualquier plan de alimentaci√≥n, te recomendamos 
                consultar con un nutricionista certificado. Cada organismo es diferente y requiere 
                un enfoque personalizado seg√∫n tu estado de salud, objetivos y necesidades espec√≠ficas.
              </p>
              <div class="disclaimer-points">
                <div class="point-item">
                  <ion-icon name="checkmark-circle" color="success" aria-hidden="true"></ion-icon>
                  <span>Los planes aqu√≠ mostrados son referencias generales</span>
                </div>
                <div class="point-item">
                  <ion-icon name="checkmark-circle" color="success" aria-hidden="true"></ion-icon>
                  <span>No reemplazas una consulta m√©dica profesional</span>
                </div>
                <div class="point-item">
                  <ion-icon name="checkmark-circle" color="success" aria-hidden="true"></ion-icon>
                  <span>Duraci√≥n m√°xima recomendada: 12 semanas</span>
                </div>
              </div>
            </ion-card-content>
          </ion-card>

          <!-- SELECCI√ìN DE DIETAS -->
          <ion-card class="bienvenida-card">
            <ion-card-header>
              <ion-card-title>¬°Comienza tu Transformaci√≥n!</ion-card-title>
              <ion-card-subtitle>Selecciona una dieta personalizada para tus objetivos</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p class="descripcion-intro">Elige entre nuestras dietas especializadas dise√±adas por nutricionistas y crea un plan a tu medida.</p>
              
              <!-- GRID DE DIETAS -->
              <div class="dietas-grid">
                <ion-card 
                  *ngFor="let dieta of dietas" 
                  class="dieta-card"
                  [style.--dieta-color]="dieta.color"
                  [attr.aria-label]="'Dieta ' + dieta.nombre + ': ' + dieta.descripcion">
                  <div class="dieta-card-header">
                    <div class="dieta-icon" [attr.aria-label]="'Icono de ' + dieta.nombre">{{dieta.icon}}</div>
                    <div class="dieta-badge" [class]="dieta.tipo">{{dieta.tipo | titlecase}}</div>
                  </div>
                  
                  <ion-card-header class="dieta-card-content">
                    <ion-card-title>{{dieta.nombre}}</ion-card-title>
                    <ion-card-subtitle>{{dieta.descripcion}}</ion-card-subtitle>
                  </ion-card-header>

                  <ion-card-content class="dieta-beneficios">
                    <div class="beneficios-list">
                      <div class="beneficio-item" *ngFor="let beneficio of dieta.beneficios.slice(0, 2)">
                        <ion-icon name="checkmark-circle" class="beneficio-icon" aria-hidden="true"></ion-icon>
                        <span>{{beneficio}}</span>
                      </div>
                    </div>
                    
                    <div class="dieta-meta">
                      <div class="dieta-calorias">
                        <ion-icon name="flame" aria-hidden="true"></ion-icon>
                        <span>{{dieta.caloriasRecomendadas.min}} - {{dieta.caloriasRecomendadas.max}} cal</span>
                      </div>
                      <div class="dieta-duracion">
                        <ion-icon name="calendar" aria-hidden="true"></ion-icon>
                        <span>{{dieta.duracionRecomendada || '4-12 semanas'}}</span>
                      </div>
                    </div>
                  </ion-card-content>

                  <div class="dieta-actions">
                    <ion-button fill="solid" color="primary" (click)="seleccionarDieta(dieta)" class="seleccionar-btn" aria-label="Seleccionar dieta">
                      Seleccionar
                    </ion-button>
                    <ion-button fill="clear" color="medium" (click)="verDetallesDieta(dieta)" class="detalles-btn" aria-label="Ver detalles de la dieta">
                      <ion-icon name="information-circle" aria-hidden="true"></ion-icon>
                    </ion-button>
                    <ion-button fill="clear" color="success" (click)="verRecetasDieta(dieta)" class="recetas-btn" aria-label="Ver recetas de la dieta">
                      <ion-icon name="fast-food" aria-hidden="true"></ion-icon>
                    </ion-button>
                  </div>
                </ion-card>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </div>

      <!-- ========================================
           üí™ SECCI√ìN EJERCICIO
           ======================================== -->
      <div *ngIf="!cargando && seccionActiva === 'ejercicio'" class="seccion-content">
        
        <ion-card class="redirect-card">
          <ion-card-header>
            <div class="redirect-icon" aria-hidden="true">üí™</div>
            <ion-card-title>Gestiona tus Ejercicios</ion-card-title>
            <ion-card-subtitle>Crea y organiza tus rutinas personalizadas</ion-card-subtitle>
          </ion-card-header>
          
          <ion-card-content>
            <p class="redirect-description">
              Hemos creado una experiencia completa para gestionar tus ejercicios con temporizador, 
              historial y estad√≠sticas detalladas.
            </p>
            
            <div class="redirect-features">
              <div class="feature-item">
                <ion-icon name="timer" color="primary" aria-hidden="true"></ion-icon>
                <span>Temporizador inteligente</span>
              </div>
              <div class="feature-item">
                <ion-icon name="stats-chart" color="primary" aria-hidden="true"></ion-icon>
                <span>Estad√≠sticas de progreso</span>
              </div>
              <div class="feature-item">
                <ion-icon name="folder" color="primary" aria-hidden="true"></ion-icon>
                <span>Historial completo</span>
              </div>
              <div class="feature-item">
                <ion-icon name="flash" color="primary" aria-hidden="true"></ion-icon>
                <span>Plantillas predefinidas</span>
              </div>
            </div>

            <ion-button 
              expand="block" 
              color="primary" 
              size="large"
              (click)="irAEjercicios()"
              class="redirect-btn"
              aria-label="Ir a la secci√≥n de ejercicios">
              <ion-icon slot="start" name="fitness" aria-hidden="true"></ion-icon>
              Ir a Mis Ejercicios
            </ion-button>
          </ion-card-content>
        </ion-card>

        <!-- QUICK STATS -->
        <ion-card class="quick-stats-card" *ngIf="estadisticasEjercicios">
          <ion-card-header>
            <ion-card-title>Tu Progreso</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="stats-grid">
              <div class="stat-box">
                <div class="stat-value">{{estadisticasEjercicios.totalEjercicios}}</div>
                <div class="stat-label">Ejercicios</div>
              </div>
              <div class="stat-box">
                <div class="stat-value">{{estadisticasEjercicios.ejerciciosCompletados}}</div>
                <div class="stat-label">Completados</div>
              </div>
              <div class="stat-box">
                <div class="stat-value">{{estadisticasEjercicios.racha}}</div>
                <div class="stat-label">Racha (d√≠as)</div>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- ========================================
         üé™ MODALES
         ======================================== -->

    <!-- MODAL DE CONFIRMACI√ìN DE DIETA CON DISCLAIMER -->
    <div *ngIf="mostrarModalDieta" class="modal-overlay" role="dialog" aria-labelledby="modal-dieta-title">
      <div class="modal-content">
        <ion-card class="modal-card">
          <ion-card-header>
            <ion-card-title id="modal-dieta-title">‚öïÔ∏è Importante: Consulta Profesional</ion-card-title>
            <ion-card-subtitle>Antes de comenzar tu plan</ion-card-subtitle>
          </ion-card-header>
          
          <ion-card-content *ngIf="dietaSeleccionadaModal">
            
            <!-- DISCLAIMER -->
            <div class="modal-disclaimer">
              <div class="disclaimer-box">
                <ion-icon name="warning" color="warning" aria-hidden="true"></ion-icon>
                <p>
                  <strong>Recomendaci√≥n importante:</strong> Antes de iniciar este plan alimenticio, 
                  consulta con un nutricionista certificado para asegurar que sea adecuado para tu 
                  salud, condici√≥n f√≠sica y objetivos personales.
                </p>
              </div>
            </div>

            <!-- INFO DE LA DIETA -->
            <div class="dieta-modal-info">
              <div class="dieta-modal-icon" [attr.aria-label]="'Icono de ' + dietaSeleccionadaModal.nombre">{{dietaSeleccionadaModal.icon}}</div>
              <div class="dieta-modal-details">
                <h3>{{dietaSeleccionadaModal.nombre}}</h3>
                <p>{{dietaSeleccionadaModal.descripcion}}</p>
              </div>
            </div>
            
            <div class="beneficios-modal">
              <h4>Beneficios principales:</h4>
              <ul>
                <li *ngFor="let beneficio of dietaSeleccionadaModal.beneficios.slice(0, 3)">
                  {{beneficio}}
                </li>
              </ul>
            </div>

            <div class="dieta-calorias-modal">
              <h4>Rango cal√≥rico recomendado:</h4>
              <p>{{dietaSeleccionadaModal.caloriasRecomendadas.min}} - {{dietaSeleccionadaModal.caloriasRecomendadas.max}} calor√≠as/d√≠a</p>
            </div>

            <div class="dieta-duracion-modal">
              <h4>Duraci√≥n:</h4>
              <p>{{dietaSeleccionadaModal.duracionRecomendada || '4-12 semanas'}}</p>
              <p class="duracion-warning">‚ö†Ô∏è No se recomienda seguir una dieta por m√°s de 12 semanas sin supervisi√≥n profesional.</p>
            </div>
          </ion-card-content>

          <div class="modal-actions">
            <ion-button 
              expand="block" 
              color="primary" 
              (click)="confirmarSeleccionDieta()"
              aria-label="Confirmar selecci√≥n de dieta">
              Entiendo y Quiero Continuar
            </ion-button>
            <ion-button 
              expand="block" 
              fill="outline" 
              color="medium"
              (click)="cancelarSeleccionDieta()"
              aria-label="Cancelar selecci√≥n de dieta">
              Cancelar
            </ion-button>
          </div>
        </ion-card>
      </div>
    </div>

    <!-- MODAL DETALLES DIETA -->
    <div *ngIf="mostrarDetallesDieta" class="modal-overlay" role="dialog" aria-labelledby="modal-detalles-title">
      <div class="modal-content large-modal">
        <ion-card class="modal-card">
          <ion-card-header>
            <ion-card-title id="modal-detalles-title">Detalles de la Dieta</ion-card-title>
            <ion-button fill="clear" slot="end" (click)="cerrarModales()" aria-label="Cerrar modal">
              <ion-icon name="close" aria-hidden="true"></ion-icon>
            </ion-button>
          </ion-card-header>
          
          <ion-card-content *ngIf="dietaDetallada">
            <div class="dieta-detalle-header">
              <div class="dieta-icon-large" [attr.aria-label]="'Icono de ' + dietaDetallada.nombre">{{dietaDetallada.icon}}</div>
              <div class="dieta-detalle-info">
                <h2>{{dietaDetallada.nombre}}</h2>
                <p class="dieta-descripcion">{{dietaDetallada.descripcion}}</p>
                <div class="dieta-meta-detalle">
                  <span class="dieta-tipo" [style.background-color]="dietaDetallada.color">{{dietaDetallada.tipo | titlecase}}</span>
                  <span class="dieta-duracion">{{dietaDetallada.duracionRecomendada}}</span>
                  <span class="dieta-dificultad">{{dietaDetallada.dificultad}}</span>
                </div>
              </div>
            </div>

            <ion-grid class="dieta-detalle-grid">
              <ion-row>
                <ion-col size="12" size-md="6">
                  <div class="detalle-section">
                    <h3>üçΩÔ∏è Alimentos Permitidos</h3>
                    <div class="alimentos-lista">
                      <ion-chip *ngFor="let alimento of dietaDetallada.alimentosPermitidos" color="success">
                        <ion-label>{{alimento}}</ion-label>
                      </ion-chip>
                    </div>
                  </div>
                </ion-col>
                <ion-col size="12" size-md="6">
                  <div class="detalle-section">
                    <h3>üö´ Alimentos a Evitar</h3>
                    <div class="alimentos-lista">
                      <ion-chip *ngFor="let alimento of dietaDetallada.alimentosEvitar" color="danger">
                        <ion-label>{{alimento}}</ion-label>
                      </ion-chip>
                    </div>
                  </div>
                </ion-col>
              </ion-row>

              <ion-row>
                <ion-col size="12" size-md="6">
                  <div class="detalle-section">
                    <h3>‚≠ê Beneficios</h3>
                    <ul class="lista-beneficios">
                      <li *ngFor="let beneficio of dietaDetallada.beneficios">
                        <ion-icon name="checkmark-circle" color="success" aria-hidden="true"></ion-icon>
                        {{beneficio}}
                      </li>
                    </ul>
                  </div>
                </ion-col>
                <ion-col size="12" size-md="6">
                  <div class="detalle-section">
                    <h3>üìã Consideraciones</h3>
                    <ul class="lista-consideraciones">
                      <li *ngFor="let consideracion of dietaDetallada.consideraciones">
                        <ion-icon name="information-circle" color="primary" aria-hidden="true"></ion-icon>
                        {{consideracion}}
                      </li>
                    </ul>
                  </div>
                </ion-col>
              </ion-row>

              <ion-row>
                <ion-col size="12">
                  <div class="detalle-section">
                    <h3>üìä Macronutrientes</h3>
                    <div class="macronutrientes-grid">
                      <div class="macronutriente-item">
                        <div class="macronutriente-label">Prote√≠nas</div>
                        <div class="macronutriente-value">{{dietaDetallada.macronutrientes?.proteinas}}</div>
                      </div>
                      <div class="macronutriente-item">
                        <div class="macronutriente-label">Carbohidratos</div>
                        <div class="macronutriente-value">{{dietaDetallada.macronutrientes?.carbohidratos}}</div>
                      </div>
                      <div class="macronutriente-item">
                        <div class="macronutriente-label">Grasas</div>
                        <div class="macronutriente-value">{{dietaDetallada.macronutrientes?.grasas}}</div>
                      </div>
                    </div>
                  </div>
                </ion-col>
              </ion-row>
            </ion-grid>

            <div class="modal-actions">
              <ion-button expand="block" color="primary" (click)="seleccionarDieta(dietaDetallada)" aria-label="Seleccionar esta dieta">
                Seleccionar esta Dieta
              </ion-button>
              <ion-button expand="block" fill="outline" color="success" (click)="verRecetasDieta(dietaDetallada)" aria-label="Ver recetas de esta dieta">
                <ion-icon slot="start" name="fast-food" aria-hidden="true"></ion-icon>
                Ver Recetas
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- MODAL RECETAS DIETA -->
    <div *ngIf="mostrarRecetasDieta" class="modal-overlay" role="dialog" aria-labelledby="modal-recetas-title">
      <div class="modal-content large-modal">
        <ion-card class="modal-card">
          <ion-card-header>
            <ion-card-title id="modal-recetas-title">Recetas para {{dietaDetallada?.nombre}}</ion-card-title>
            <ion-button fill="clear" slot="end" (click)="cerrarModales()" aria-label="Cerrar modal de recetas">
              <ion-icon name="close" aria-hidden="true"></ion-icon>
            </ion-button>
          </ion-card-header>
          
          <ion-card-content>
            <div *ngIf="recetasDietaSeleccionada.length === 0" class="empty-recetas">
              <div class="empty-icon" aria-hidden="true">üçΩÔ∏è</div>
              <h3>No hay recetas disponibles</h3>
              <p>No se encontraron recetas para esta dieta</p>
            </div>

            <div class="recetas-grid" *ngIf="recetasDietaSeleccionada.length > 0">
              <ion-card *ngFor="let receta of recetasDietaSeleccionada" class="receta-card" (click)="verReceta(receta.id)" [attr.aria-label]="'Receta: ' + receta.titulo">
                <ion-card-header>
                  <ion-card-title>{{receta.titulo}}</ion-card-title>
                  <ion-card-subtitle>{{receta.descripcion}}</ion-card-subtitle>
                </ion-card-header>

                <ion-card-content>
                  <div class="receta-meta">
                    <div class="receta-info">
                      <span class="tiempo">{{receta.tiempoTotal}} min</span>
                      <span class="calorias">{{receta.calorias}} cal</span>
                      <span class="porciones">{{receta.porciones}} porciones</span>
                      <span class="dificultad" [class]="receta.dificultad">{{receta.dificultad}}</span>
                    </div>
                    
                    <div class="receta-nutricion">
                      <div class="nutriente">
                        <strong>P:</strong> {{receta.nutricion?.proteinas || 0}}g
                      </div>
                      <div class="nutriente">
                        <strong>C:</strong> {{receta.nutricion?.carbohidratos || 0}}g
                      </div>
                      <div class="nutriente">
                        <strong>G:</strong> {{receta.nutricion?.grasas || 0}}g
                      </div>
                    </div>
                  </div>

                  <div class="receta-actions">
                    <ion-button fill="solid" color="primary" (click)="verReceta(receta.id); $event.stopPropagation()" aria-label="Ver receta completa">
                      Ver Receta
                    </ion-button>
                  </div>
                </ion-card-content>
              </ion-card>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Espaciador para el men√∫ inferior -->
    <div class="bottom-spacer"></div>
  </div>
</ion-content>