<!-- Header especÃ­fico para Home -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="openMainMenu()">
        <ion-icon slot="icon-only" name="menu"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title class="logo-title">
      <div class="title-content">
        <!-- Logo igual al del login -->
        <div class="logo-container">
          <div class="logo-image">
            <img 
              src="assets/Nupsi/nupsiLogo.png" 
              alt="NutPsi" 
              class="logo-img"
              (error)="onLogoError()">
          </div>
        </div>
        <span>NutPsi</span>
      </div>
    </ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="openProfileMenu($event)">
        <ion-icon slot="icon-only" name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="home-content" style="--padding-top: 80px; --padding-bottom: 100px;">
  <div class="content-wrapper">
    
    <!-- ============================================
         MENSAJE PARA USUARIOS NO AUTENTICADOS
         ============================================ -->
    @if (!user) {
      <div class="not-authenticated">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Â¡Bienvenido a NutPsi!</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p>Inicia sesiÃ³n para comenzar a registrar tu bienestar diario.</p>
            <ion-button expand="block" routerLink="/login" color="primary">
              Iniciar SesiÃ³n
            </ion-button>
          </ion-card-content>
        </ion-card>
      </div>
    }

    <!-- ============================================
         CONTENIDO PARA USUARIOS AUTENTICADOS
         ============================================ -->
    @if (user) {
      <div class="authenticated-content">
      
      <!-- SECCIÃ“N DE BIENVENIDA -->
      <div class="welcome-section">
        <h1 class="greeting">Â¡Hola, {{ userName }}! ðŸ‘‹</h1>
        <p class="date">{{ currentDate | date: 'EEEE, d \'de\' MMMM \'de\' yyyy' }}</p>
      </div>

      <!-- ============================================
           NUEVA SECCIÃ“N: ACCESO RÃPIDO A EJERCICIOS Y NUTRICIÃ“N
           ============================================ -->
      <div class="quick-access-section">
        <h2 class="section-title-improved">
          <ion-icon name="flash" class="title-icon"></ion-icon>
          Acceso RÃ¡pido
        </h2>
        
        <div class="quick-access-grid">
          <!-- TARJETA EJERCICIOS -->
          <ion-card button routerLink="/ejercicios" class="quick-access-card feature-card">
            <ion-card-header class="quick-access-header">
              <div class="card-icon-container exercise-icon">
                <ion-icon name="barbell" class="feature-icon"></ion-icon>
              </div>
              <ion-card-title class="card-title-small">Ejercicios</ion-card-title>
            </ion-card-header>
            <ion-card-content class="quick-access-content">
              <p class="feature-description">Rutinas y entrenamientos personalizados</p>
              <div class="access-indicator">
                <span class="indicator-text">Comenzar entrenamiento</span>
                <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
              </div>
            </ion-card-content>
          </ion-card>

          <!-- TARJETA NUTRICIÃ“N -->
          <ion-card button routerLink="/planes" class="quick-access-card feature-card">
            <ion-card-header class="quick-access-header">
              <div class="card-icon-container nutrition-icon">
                <ion-icon name="nutrition" class="feature-icon"></ion-icon>
              </div>
              <ion-card-title class="card-title-small">NutriciÃ³n</ion-card-title>
            </ion-card-header>
            <ion-card-content class="quick-access-content">
              <p class="feature-description">Planes alimenticios y recetas saludables</p>
              <div class="access-indicator">
                <span class="indicator-text">Ver planes</span>
                <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </div>

      <!-- ============================================
           TARJETA: Â¿CÃ“MO TE SIENTES HOY?
           ============================================ -->
      <ion-card class="question-card">
        <ion-card-header>
          <ion-card-title class="card-title-small">Estado Emocional</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="question-text">Â¿CÃ³mo te sientes hoy?</p>
          
          <div class="emotions-container">
            @for (emotion of emotionButtons; track emotion.label) {
              <ion-button 
                [color]="emotion.selected ? emotion.color : 'light'"
                class="emotion-button"
                (click)="toggleEmotion(emotion)"
                [attr.aria-label]="emotion.label"
                [class.selected]="emotion.selected">
                <div class="button-content">
                <span class="emoji">{{ emotion.emoji }}</span>
                <span class="button-text">{{ emotion.label }}</span>
              </div>
              </ion-button>
            }
          </div>

          @if (selectedEmotions.length > 0) {
            <p class="selection-info">
              Has seleccionado: {{ selectedEmotions.join(', ') }}
            </p>
          }
          @if (selectedEmotions.length === 0) {
            <p class="selection-info">
              Selecciona una o mÃ¡s emociones
            </p>
          }
        </ion-card-content>
      </ion-card>

      <!-- ============================================
           TARJETA: HIDRATACIÃ“N
           ============================================ -->
      <ion-card class="question-card">
        <ion-card-header>
          <ion-card-title class="card-title-small">HidrataciÃ³n</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="question-text">Â¿CuÃ¡ntos vasos de agua has tomado hoy?</p>
          
          <div class="water-tracker">
            <ion-button 
              fill="clear" 
              size="large"
              (click)="decrementarVasosAgua()"
              [disabled]="vasosAgua === 0">
              <ion-icon slot="icon-only" name="remove-circle-outline" size="large"></ion-icon>
            </ion-button>

            <div class="water-count">
              <span class="water-icon">ðŸ’§</span>
              <span class="water-number">{{ vasosAgua }}</span>
              <span class="water-text">/ {{ metaVasosAgua }} vasos</span>
            </div>

            <ion-button 
              fill="clear" 
              size="large"
              (click)="incrementarVasosAgua()"
              [disabled]="vasosAgua >= 20">
              <ion-icon slot="icon-only" name="add-circle-outline" size="large"></ion-icon>
            </ion-button>
          </div>

          <!-- Barra de progreso -->
          <div class="water-progress">
            <div class="progress-bar">
              <div 
                class="progress-fill" 
                [style.width.%]="(vasosAgua / metaVasosAgua) * 100">
              </div>
            </div>
            <p class="progress-text">
              {{ ((vasosAgua / metaVasosAgua) * 100) | number: '1.0-0' }}% de tu meta diaria
            </p>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- ============================================
           SECCIÃ“N DE PROGRESO MEJORADA
           ============================================ -->
      @if (usuarioData?.haCompletadoConfiguracionInicial) {
        <div class="progress-section-improved">
        <h2 class="section-title-improved">
          <ion-icon name="trending-up" class="title-icon"></ion-icon>
          Tu Progreso
        </h2>
        
        <ion-card class="progress-card-improved">
          <ion-card-header class="progress-header">
            <ion-card-title class="card-title-small-improved">Resumen Semanal</ion-card-title>
          </ion-card-header>
          <ion-card-content class="progress-content">
            <div class="progress-items-container">
              <div class="progress-item-improved">
                <div class="progress-info-improved">
                  <div class="icon-wrapper">
                    <ion-icon name="calendar-outline" class="progress-icon-improved"></ion-icon>
                  </div>
                  <div class="text-content">
                    <span class="progress-label-improved">Registros esta semana</span>
                    <div class="progress-bar-mini">
                      <div class="progress-fill-mini" [style.width.%]="(5/7)*100"></div>
                    </div>
                  </div>
                </div>
                <span class="progress-value-improved">5/7</span>
              </div>

              <div class="progress-divider"></div>

              <div class="progress-item-improved">
                <div class="progress-info-improved">
                  <div class="icon-wrapper">
                    <ion-icon name="water" class="progress-icon-improved"></ion-icon>
                  </div>
                  <div class="text-content">
                    <span class="progress-label-improved">Meta de hidrataciÃ³n</span>
                    <div class="progress-bar-mini">
                      <div class="progress-fill-mini" [style.width.%]="(vasosAgua/metaVasosAgua)*100"></div>
                    </div>
                  </div>
                </div>
                <span class="progress-value-improved">
                  {{ vasosAgua >= metaVasosAgua ? 'âœ… Completado' : vasosAgua + '/' + metaVasosAgua }}
                </span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
        </div>
      }

      <!-- ============================================
           SECCIÃ“N DE INTELIGENCIA ARTIFICIAL
           ============================================ -->
      <div class="ml-section">
        <h2 class="section-title-ml">
          <ion-icon name="analytics" class="title-icon"></ion-icon>
          Tu Asistente IA
        </h2>
        <p class="ml-description">
          AnÃ¡lisis inteligente de tu bienestar emocional y fÃ­sico
        </p>
      </div>

      <div class="action-buttons-improved">
        @if (usuarioData?.haCompletadoConfiguracionInicial) {
          <div class="action-buttons-ml">
          <!-- BOTÃ“N 1: REGISTRO DIARIO -->
          <ion-button 
            expand="block" 
            color="primary" 
            class="ml-button ml-button-form"
            routerLink="/ml-daily-form">
            <ion-icon slot="start" name="create"></ion-icon>
            Registro Diario
          </ion-button>

          <!-- BOTÃ“N 2: ANÃLISIS EMOCIONAL IA -->
          <ion-button 
            expand="block" 
            color="secondary" 
            class="ml-button ml-button-aura"
            routerLink="/aura-insights">
            <ion-icon slot="start" name="sparkles"></ion-icon>
            AnÃ¡lisis Emocional IA
          </ion-button>

          <!-- BOTÃ“N 3: MI BIENESTAR -->
          <ion-button 
            expand="block" 
            color="tertiary" 
            class="ml-button ml-button-bienestar"
            routerLink="/bienestar-integral">
            <ion-icon slot="start" name="heart-circle-outline"></ion-icon>
            Mi Bienestar
          </ion-button>

          <!-- BOTÃ“N 4: HISTORIAL -->
          <ion-button 
            expand="block" 
            color="medium" 
            class="ml-button ml-button-history"
            routerLink="/ml-history">
            <ion-icon slot="start" name="time"></ion-icon>
            Mi Historial
          </ion-button>
        </div>
        }

        @if (!usuarioData?.haCompletadoConfiguracionInicial) {
          <ion-button 
            expand="block" 
            color="primary" 
            class="primary-button-improved"
            (click)="openDailyRegister()">
            <ion-icon slot="start" name="rocket-outline"></ion-icon>
            Comenzar Mi Viaje
          </ion-button>
        }
      </div>

      <!-- ============================================
           TARJETA DE TIP MOTIVACIONAL MEJORADA
           ============================================ -->
      <ion-card class="tip-card-improved">
        <div class="tip-header-improved">
          <div class="tip-icon-container">
            <ion-icon name="sparkles" class="tip-main-icon"></ion-icon>
          </div>
          <ion-card-header class="tip-card-header">
            <ion-card-title class="card-title-small-improved">
              InspiraciÃ³n del DÃ­a
            </ion-card-title>
          </ion-card-header>
        </div>
        <ion-card-content class="tip-content-improved">
          <p class="tip-text-improved">{{ fraseMotivacional }}</p>
          <div class="tip-decoration">âœ¨</div>
        </ion-card-content>
      </ion-card>

      <!-- Espaciador para el menÃº inferior -->
      <div class="bottom-spacer"></div>

      </div>
    }
  </div>
</ion-content>

<!-- ============================================
     FOOTER MENU - MENÃš INFERIOR
     ============================================ -->
<app-menu></app-menu>