version: "3.1"

intents:
  - greet
  - goodbye
  - thanks
  - affirm
  - deny
  - bot_challenge
  - introduce_bot
  - ask_capabilities
  # Dominio nutrici√≥n / fitness / bienestar
  - ask_diet_general
  - ask_specific_food
  - ask_meal_planning
  - ask_hydration
  - ask_weight_loss
  - ask_exercise_general
  - ask_workout_plan
  - ask_muscle_group
  - ask_cardio_benefits
  - ask_strength_training
  - ask_progress_tracking
  - ask_motivation_support
  # NUEVO: Intent para capturar consultas m√©dicas
  - ask_medical_diagnosis 
  - out_of_scope
  # Dominio emocional
  - express_sadness
  - express_anxiety
  - express_anger
  - express_happiness
  - ask_emotional_support
  - ask_stress_management
  - ask_emotional_eating
  - ask_healthy_snacks
  # Fallback + modo avanzado (Se mantiene 'ask_gemini' para preguntas directas complejas)
  - nlu_fallback
  - ask_gemini
  # NUEVOS INTENTS PARA B√öSQUEDA
  - ask_for_professional_near # <-- Se usar√° en rules.yml
  - provide_location # <-- Se usar√° en stories.yml

entities:
  - macronutrient
  - muscle_group
  - goal
  - region # <-- Aseg√∫rate que esta entidad est√© definida en tu nlu.yml

slots:
  macronutrient:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: macronutrient

  muscle_group:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: muscle_group

  goal:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: goal

  # SE ELIMIN√ì: gemini_active

  # NUEVO: Slot para manejar el flujo de centros de salud
  asked_for_health_center:
    type: bool
    initial_value: false
    influence_conversation: false
    mappings:
      - type: custom

  # NUEVO: Slot para la regi√≥n (si se logra detectar o pedir)
  user_region:
    type: text
    influence_conversation: true # Se cambi√≥ a true para que la ubicaci√≥n se mantenga en el slot
    mappings:
      - type: from_entity
        entity: region # <-- Mapeo desde la entidad 'region'
      - type: custom

  # üü¢ NUEVOS: Slots para la Geolocalizaci√≥n (Escalable)
  latitude:
    type: float
    influence_conversation: false
    mappings:
      - type: custom
  longitude:
    type: float
    influence_conversation: false
    mappings:
      - type: custom

  # üü¢ NUEVOS: Slots de Control del Flujo de B√∫squeda de Profesionales
  asked_for_location:
    type: bool
    initial_value: false
    influence_conversation: false
    mappings:
      - type: custom
  is_searching_professional:
    type: bool
    initial_value: false
    influence_conversation: false
    mappings:
      - type: custom
      
  # ‚Äî‚Äî Slots del formulario de perfil (EXISTENTES) ‚Äî‚Äî
  user_goal:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: nutrition_profile_form
            requested_slot: user_goal

  dietary_restrictions:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: nutrition_profile_form
            requested_slot: dietary_restrictions

  activity_level:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: nutrition_profile_form
            requested_slot: activity_level

  # ‚Äî‚Äî Datos para IMC/recetas (EXISTENTES) ‚Äî‚Äî
  weight_kg:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  height_m:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  recipe_type:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        intent:
          - ask_meal_planning

forms:
  nutrition_profile_form:
    required_slots:
      - user_goal
      - dietary_restrictions
      - activity_level

responses:
  # Saludo / cierre / meta
  utter_greet:
    - text: "¬°Hola! Soy tu asistente de nutrici√≥n y cambios f√≠sicos. ¬øEn qu√© te ayudo hoy?"
  utter_goodbye:
    - text: "¬°Gracias por conversar! ¬°√Ånimo con tus objetivos! üëã"
  utter_thanks:
    - text: "¬°Con gusto! ¬øAlgo m√°s en lo que te pueda apoyar?"
  utter_iamabot:
    - text: "Soy un asistente virtual especializado en nutrici√≥n, ejercicio y bienestar."
  utter_default:
    - text: "Perd√≥n, no entend√≠ bien. ¬øPuedes reformular tu pregunta con m√°s detalles?"

  # Capacidades
  utter_ask_capabilities:
    - text: "Puedo ayudarte con alimentaci√≥n saludable, planes de comida, rutinas, seguimiento de progreso y apoyo emocional."

  # Nutrici√≥n
  utter_ask_diet_general:
    - text: "Basea tu alimentaci√≥n en verduras, frutas, legumbres, granos integrales, prote√≠nas de calidad y grasas saludables. ¬øCu√°l es tu objetivo?"
  utter_ask_specific_food:
    - text: "¬øQu√© alimento te interesa? Si quieres, dime si lo consultas por calor√≠as, prote√≠nas o beneficios."
  utter_ask_meal_planning:
    - text: "Planifica 3‚Äì4 comidas + 1‚Äì2 snacks, define calor√≠as/objetivo y prepara batch cooking. ¬øQuieres un ejemplo semanal?"
  utter_ask_hydration:
    - text: "Apunta a ~30‚Äì35 ml/kg/d√≠a y ajusta por clima/actividad. ¬øHaces ejercicio?"
  utter_ask_weight_loss:
    - text: "D√©ficit cal√≥rico moderado + fuerza + cardio + sue√±o. ¬øQuieres un men√∫ base y recomendaciones de entrenamiento?"

  # Ejercicio
  utter_ask_exercise_general:
    - text: "Empieza con 2‚Äì3 sesiones de fuerza y 2 de cardio suave. ¬øEntrenas en casa o gimnasio?"
  utter_ask_workout_plan:
    - text: "¬øBuscas plan para casa o gimnasio y cu√°ntos d√≠as por semana puedes entrenar?"
  utter_ask_cardio_benefits:
    - text: "El cardio mejora la salud cardiovascular y la recuperaci√≥n. 90‚Äì150 min/semana es un buen inicio."
  utter_ask_strength_training:
    - text: "La fuerza ayuda a ganar/retener m√∫sculo y mejorar el metabolismo. 2‚Äì4 sesiones/semana por grupos musculares."

  # Emocional / bienestar
  utter_express_sadness:
    - text: "Siento que te sientas as√≠. Demos pasos peque√±os y realistas. Estoy contigo."
  utter_express_anxiety:
    - text: "Respiremos 4-4-8. Enfoqu√©monos en acciones peque√±as que controlas hoy."
  utter_express_anger:
    - text: "Entiendo la frustraci√≥n. Una pausa y algo de movimiento puede ayudar."
  utter_express_happiness:
    - text: "¬°Genial! Aprovechemos esa energ√≠a para consolidar h√°bitos."
  utter_ask_emotional_support:
    - text: "¬øTe dejo un mini plan para hoy (h√°bitos, respiraci√≥n y organizaci√≥n)?"
  utter_ask_stress_management:
    - text: "Prueba 5 min de respiraci√≥n diafragm√°tica, pausas activas y l√≠mites de horario. ¬øTe env√≠o una rutina breve?"
  utter_out_of_scope:
    - text: "Ese tema est√° fuera de mi alcance. Puedo ayudarte con nutrici√≥n, ejercicio y bienestar."
  utter_ask_emotional_eating:
    - text: "Distingamos entre hambre f√≠sica y emocional. ¬øQuieres alternativas de snack y un plan anti-antojos?"
  utter_ask_healthy_snacks:
    - text: "Ideas: yogur + fruta, frutos secos, hummus + zanahoria, avena con leche, s√°ndwich integral de pavo."
  utter_ask_motivation_support: 
    - text: "La motivaci√≥n es clave. Recuerda tu 'por qu√©'. Peque√±os avances constantes son mejor que grandes saltos espor√°dicos. ¬°Conf√≠o en ti!"

  # Form
  utter_ask_nutrition_profile_form_user_goal:
    - text: "¬øCu√°l es tu objetivo principal? (perder grasa, ganar m√∫sculo, rendimiento)"
  utter_ask_nutrition_profile_form_dietary_restrictions:
    - text: "¬øTienes restricciones o preferencias? (vegetariano, sin lactosa, alergias)"
  utter_ask_nutrition_profile_form_activity_level:
    - text: "¬øCu√°l es tu nivel de actividad? (sedentario, ligero, moderado, alto)"
  utter_submit_nutrition_profile_form:
    - text: "¬°Perfecto! Con esto puedo proponerte pautas personalizadas. ¬øQuieres un plan semanal base?"

actions:
  # Acciones de dominio
  - action_answer_specific_food
  - action_propose_meal_plan
  - action_propose_workout
  - action_track_progress_tip
  - action_calculate_bmi
  - action_provide_recipe
  # NUEVAS ACCIONES M√âDICAS
  - action_handle_medical_query
  - action_provide_health_centers
  # Acciones Gemini
  - action_fallback_to_gemini
  - action_call_gemini_chat
  # NUEVAS ACCIONES DE B√öSQUEDA
  - action_search_nearby_professional # <-- ¬°NUEVA ACCI√ìN!
  # Formularios
  - nutrition_profile_form

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true